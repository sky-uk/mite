<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Prometheus and Mite" href="data-visualization.html" /><link rel="prev" title="Quick start" href="quick-start.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Design and deployment - Mite 2.4.9 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     <div>Follow and Fork me on GitHub! <a href='https://github.com/sky-uk/mite'><i class='fa-brands fa-solid fa-github'></i></a> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Mite 2.4.9 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/mite.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/mite.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Mite 2.4.9 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Set up Mite</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">Quick start</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Design and deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-visualization.html">Prometheus and Mite</a></li>
<li class="toctree-l1"><a class="reference internal" href="test-examples.html">WIP - Advance Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-references.html">API references</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing-guidelines.html">WIP - Contributing Guide</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/design-deployment.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="design-and-deployment">
<h1>Design and deployment<a class="headerlink" href="#design-and-deployment" title="Link to this heading">¶</a></h1>
<section id="design-of-mite">
<h2>Design of mite<a class="headerlink" href="#design-of-mite" title="Link to this heading">¶</a></h2>
<p>Mite is designed as a distributed system made up of several components.
Some are required, and others are optional.  The components communicate
over TCP, so you can run them anywhere that they can talk to each other
in this fashion: as ordinary processes on a single machine, in
containers (on a single machine or in a cloud container orchestration
environment like Kubernetes) or on different machines entirely.</p>
<p>The components that make up mite are:</p>
<ul class="simple">
<li><p>controller*: manages a test scenario and feeds tasks to the runners.</p></li>
<li><p>runner: responsible for injecting the test load into the target system</p></li>
<li><p>duplicator*: a message router between the controller/runner and their
downstream components</p></li>
<li><p>collector: logs messages appearing on the mite message bus to a file</p></li>
<li><p>receiver: dispatches incoming messages to connected <code class="docutils literal notranslate"><span class="pre">processors</span></code></p></li>
<li><p>recorder*: listens for special messages on the bus and records them
to a file.</p></li>
</ul>
<ul class="simple">
<li><p>stats: aggregates raw messages from the controller and runner into
statistical summaries</p></li>
<li><p>exporter*: (aka prometheus exporter) listens for aggregations from the
stats component, and exposes these via HTTP to a</p></li>
</ul>
<p>The components marked with an asterisk are singletons; the rest can be
scaled up to meet the demand of the test.  The communication pathways
between the components are represented in the following diagram:</p>
<div class="graphviz"><img src="_images/graphviz-227083ec1813b56d9be23632c27ae9264b8a6c3f.png" alt="digraph architecture {

 runner -&gt; duplicator;
 controller -&gt; duplicator;
 duplicator -&gt; stats;
 duplicator -&gt; collector;
 duplicator -&gt; recorder;
 stats -&gt; exporter;

 subgraph cluster_receiver {
   graph[style=dotted];
   node [style=filled];
   stats collector;
   label = &quot;receiver                                   &quot;;
   color=black;
 }

 subgraph rc {
   rank=&quot;same&quot;
   runner
   controller
   runner -&gt; controller [dir=both, label = &quot;    &quot;];
 }

}" class="graphviz" /></div>
</section>
<section id="distributed-components">
<h2>Distributed components<a class="headerlink" href="#distributed-components" title="Link to this heading">¶</a></h2>
<p>In order to achieve high throughput, it’s necessary to split mite into
discrete components and distribute them across cores/machines.  Mite as
an entity consists of a number of these components, each with their own
responsibilities for test control, execution and/or data collection.</p>
<section id="duplicator">
<h3>Duplicator<a class="headerlink" href="#duplicator" title="Link to this heading">¶</a></h3>
<p>The mite duplicator is responsible for ingesting messages from multiple
sources and then duplicating them to other components.  It ensures that
messages that arrive at an incoming socket are distributed exactly once
to each of N outgoing sockets.  It is usually the first component to
start.  The controller and runners feed their logs into the duplicator
and cannot run without it.  Only one duplicator can run at a time.</p>
<p>To start the duplicator with one inbound socket (<code class="docutils literal notranslate"><span class="pre">--message-socket</span></code>)
and two outbound sockets (the remaining arguments) for the stats and
collector components, run the following.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mite<span class="w"> </span>duplicator<span class="w"> </span>--message-socket<span class="o">=</span>tcp://0.0.0.0:14302<span class="w"> </span>tcp://127.0.0.1:14303<span class="w"> </span>tcp://127.0.0.1:14304
</pre></div>
</div>
</section>
<section id="stats">
<h3>Stats<a class="headerlink" href="#stats" title="Link to this heading">¶</a></h3>
<p>The mite stats component aggregates statistics out of the messages
passed from the collector.  As many stats daemons can be run as is
necessary to achieve desired throughput. It can be passed an optional
in and out socket, but in our case we’ll just run it with default
sockets.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mite<span class="w"> </span>stats
</pre></div>
</div>
<p>The default in socket is <code class="docutils literal notranslate"><span class="pre">tcp://127.0.0.1:14304`</span></code> which we previously
told our duplicator to output on.  The default output socket is on
port 14305.</p>
</section>
<section id="collector">
<h3>Collector<a class="headerlink" href="#collector" title="Link to this heading">¶</a></h3>
<p>The mite collector is an optional component designed to write the raw
logs to files.  It defaults to writing 10000 log lines to a file before
rolling and timestamping the file.  The most recent file is named
<code class="docutils literal notranslate"><span class="pre">current</span></code>.  Again, as many of these can be run as is necessary to
achieve throughput.  However, each collector must be passed a different
<code class="docutils literal notranslate"><span class="pre">--collector-dir</span></code>, to avoid them overwriting each otherʼs logs.  The
log lines will be round-robined across all the collectorsʼ output
directories.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mite<span class="w"> </span>collector<span class="w"> </span>--collector-dir<span class="w"> </span>mite-logs
</pre></div>
</div>
</section>
<section id="recorder">
<h3>Recorder<a class="headerlink" href="#recorder" title="Link to this heading">¶</a></h3>
<p>The mite recorder is an optional component designed to record data to
disk.  It can be used for storing values created during</p>
<p>handling
messages of the type <code class="docutils literal notranslate"><span class="pre">data_created</span></code> to write data and <code class="docutils literal notranslate"><span class="pre">purge_data</span></code>
to delete old recorded values.  There is an optional <code class="docutils literal notranslate"><span class="pre">--recorder-dir</span></code>
argument to specify a folder where files are created.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mite<span class="w"> </span>recorder
</pre></div>
</div>
<p>Logs are compressed with <a class="reference external" href="https://msgpack.org/index.html">msgpack</a>; the repo includes a <code class="docutils literal notranslate"><span class="pre">cat_msgpack.py</span></code>
script for quickly dumping their contents (but the most common usage will
be to read them in programmatically in test journey files).  We could also
have specified an optional inbound socket but here we are relying on the
default of <code class="docutils literal notranslate"><span class="pre">tcp://127.0.0.1:14303</span></code>, previously specified as an output
socket for the duplicator.</p>
</section>
<section id="receiver">
<h3>Receiver<a class="headerlink" href="#receiver" title="Link to this heading">¶</a></h3>
<p>The mite receiver component is a generic mechanism that can perform tasks
not limited to fulfilling a single role (eg. stats, collector). This allows
changing a mite pipeline more easily, without introducing new processes and
network components. A <code class="docutils literal notranslate"><span class="pre">mite.cli.receiver</span></code> instance can have multiple custom
<code class="docutils literal notranslate"><span class="pre">processors</span></code> connected to it as either listeners or raw listeners and can
dispatch incoming messages to them.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mite<span class="w"> </span>receiver<span class="w"> </span>tcp://127.0.0.1:14303<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--processor<span class="o">=</span>my.custom.processors:StatsProcessor<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--processor<span class="o">=</span>my.custom.processors:CollectorProcessor

mite<span class="w"> </span>receiver<span class="w"> </span>tcp://127.0.0.1:14310<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--processor<span class="o">=</span>my.custom.processors:PrintProcessor
</pre></div>
</div>
</section>
<section id="prometheus-exporter">
<h3>Prometheus Exporter<a class="headerlink" href="#prometheus-exporter" title="Link to this heading">¶</a></h3>
<p>The prometheus exporter provides a http metrics endpoint for the time series database to scrape,
pulling metrics from the stats components.  In our case, the stats
components will output on its default socket and the exporter is
configured to read from there by default.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mite<span class="w"> </span>prometheus_exporter
</pre></div>
</div>
<p>There is more about data visualization in the next page (<a class="reference internal" href="data-visualization.html"><span class="doc">Data visualization</span></a>).</p>
</section>
<section id="runners">
<h3>Runners<a class="headerlink" href="#runners" title="Link to this heading">¶</a></h3>
<p>The mite runners are the component responsible for injecting the load
into the system under test.  As many of these can be created as is
necessary for the volume of load you are injecting, but for optimum
performance you should make sure that each has a whole CPU core on
which to run.  The runner needs two arguments, a socket it can use to
talk to the controller and a message socket it can use to send messages
to the duplicator.  In the below instance we’ll let it use the defaults
of 14301 for communicating with the controller and 14302 for  messages
out to the duplicator.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mite<span class="w"> </span>runner
</pre></div>
</div>
</section>
<section id="controller">
<h3>Controller<a class="headerlink" href="#controller" title="Link to this heading">¶</a></h3>
<p>The last component to run is the mite controller.  It dictates the
scenario to run, loads and distrbutes the config to the runners and is
responsible for managing the work that the runners are doing.  As all
our components are set up to use default sockets, we just have to
specify the scenario to run, in the format of a python importable module
and a name in that module (separated by a colon).</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mite<span class="w"> </span>controller<span class="w"> </span>mite.example:scenario
</pre></div>
</div>
</section>
</section>
<section id="useful-topologies">
<span id="id1"></span><h2>Useful topologies<a class="headerlink" href="#useful-topologies" title="Link to this heading">¶</a></h2>
<p>While itʼs true that increasing the heft of a test scenario increases
the load on all miteʼs components, nowhere is the increase more apparent
than on the runners, the component directly responsible for injecting
the load on a 1:1 basis into the target system.  Therefore, it makes the
most sense to separate the runners from the other components of mite.
This both avoids interference between the components and makes it easy
to scale the resources devoted to the runners.</p>
<div class="note admonition">
<p class="admonition-title">Resource usage</p>
<p>In the following sections, we describe our “real-world” usage of mite.
This infrastructure is somewhat overprovisioned for our needs, but our
focus has been on the performance of the applications which we test.
While not wishing to be profligate, we believe it would be a mistake to
shrink the injection infrastructure close to its performance limits.
When resource constraints appear in an NFT exercise, they should stem
from the system under test and not the test apparatus.  Anything other
than the most occasional exception to this rule is an indication that
the NFT is not efficiently organized.</p>
<p>In fact, we have reason to believe that the peak performance of mite, in
terms of maximum throughput per CPU and memory devoted to running mite,
is significantly above what is implied by these numbers.  Furthermore,
our resource usage already compares favorably with other performance
engineering teams in Sky using different tools, even without having
performed a dedicated performance tuning of our injection
infrastructure.</p>
</div>
<section id="single-machine">
<h3>Single machine<a class="headerlink" href="#single-machine" title="Link to this heading">¶</a></h3>
<p>In the doc/example/ directory, you will find a docker-compose.yml file
which will deploy a full mite stack, along with supporting programs, on
your local machine.  While impractical for running a significant load
injection exercise (due to the performance limitations of a single
machine), this serves to illustrate the mechanics of getting the
components to talk to each other and the outside world.  For a concrete,
configuration-level view of setting up a mite pipeline, the reader is
referred to the files in that directory.  In the sections that follow,
we will discuss a few more abstract considerations for deploying mite in
different kinds of environments.</p>
</section>
<section id="virtual-machines">
<h3>Virtual machines<a class="headerlink" href="#virtual-machines" title="Link to this heading">¶</a></h3>
<p>At Sky, we have run mite in a configuration with 4 virtual machines.  One,
with 16GB of memory and 16 cores, hosts the controller, duplicator, stats,
exporter, and (if warranted) collector and recorder.  The other three have
8GB of memory and 16 cores each, and each host 16 runner processes.  Our
system under test consists of a 1:1 replica of the production environment,
deployed with each weekly release candidate.  The underlying hardware is
in a corporate datacentre (though it could just as easily correspond to
servers rented from a colocation facility or VM provider).  We regard
this as fairly typical of a traditional NFT setup in a medium to large
tech company.</p>
<p>We have used this infrastructure to inject load of up to 12k tps into
our system under test across a variety of journeys, including some which
simulate full user interaction with the platform, i.e. signin → modify
data → signout.</p>
<p>(Note that the provisioning of our test injection infrastructure is also
undercharacterized above: far more important than memory for the runners
is the bandwidth from them to the system under test – which is also less
straightforward to quantify in the than VM size.  Our injectors and
system under test are colocated in the same datacentres, both on the
inside of the corporate firewall.  This provides ample bandwidth for our
use case.)</p>
<p>We hope that this description of our usage will provide you with an idea
of the scale of infrastructure which mite requires to run, and will help
you to architect your deployment as well.</p>
</section>
<section id="the-cloud">
<h3>The Cloud<a class="headerlink" href="#the-cloud" title="Link to this heading">¶</a></h3>
<p>In addition to the traditional VM-based deployment described above, we
have also used mite in a “cloud” environment – specifically in a
kubernetes cluster.  As above this is provisioned by the company, but
could just as easily be part of a hosted kubernetes offering such as
GKE.</p>
<p>In addition to the difference in the space into which the applications
are deployed, this environment also comes with a different release
cadence: continuous delivery is used with nightly NFT runs (recycling
the resources that are used to run CI testing during the day as
developers work on the code).  Finally, the environment also has NFRs
that are roughly an order of magnitude larger than the traditional
VM-based one.</p>
<p>Mite as a distributed system made of discrete units is in many ways
well-adapted to such an environment.  We have deployed it into the cluster
with the following resource allocations:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Replicas</p></th>
<th class="head"><p>CPU</p></th>
<th class="head"><p>Memory</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Controller</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>500MB</p></td>
</tr>
<tr class="row-odd"><td><p>Duplicator</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>100MB</p></td>
</tr>
<tr class="row-even"><td><p>Exporter</p></td>
<td><p>1</p></td>
<td><p>0.25</p></td>
<td><p>100MB</p></td>
</tr>
<tr class="row-odd"><td><p>Runner</p></td>
<td><p>50</p></td>
<td><p>1</p></td>
<td><p>500MB</p></td>
</tr>
<tr class="row-even"><td><p>Stats</p></td>
<td><p>20</p></td>
<td><p>1</p></td>
<td><p>50MB</p></td>
</tr>
</tbody>
</table>
</div>
<p>For injecting loads of up to 22k tps, we have found 50 runners and 20
stats to be more than sufficient.  (We have noted that the abstract
“CPU” is more performant in this environment than in the VMs in the
previous section.)  As before, the network bandwidth used by mite in
this environment is not characterized; we have not run into problems
with our assumption that all the relevant pipes are fat enough for
within-cluster communication of the scale that we require.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="data-visualization.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Prometheus and Mite</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="quick-start.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Quick start</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Sky UK - Identity performance engineers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link fa-brands fa-solid fa-github fa-2x" href="https://github.com/sky-uk/mite" aria-label="GitHub"></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Design and deployment</a><ul>
<li><a class="reference internal" href="#design-of-mite">Design of mite</a></li>
<li><a class="reference internal" href="#distributed-components">Distributed components</a><ul>
<li><a class="reference internal" href="#duplicator">Duplicator</a></li>
<li><a class="reference internal" href="#stats">Stats</a></li>
<li><a class="reference internal" href="#collector">Collector</a></li>
<li><a class="reference internal" href="#recorder">Recorder</a></li>
<li><a class="reference internal" href="#receiver">Receiver</a></li>
<li><a class="reference internal" href="#prometheus-exporter">Prometheus Exporter</a></li>
<li><a class="reference internal" href="#runners">Runners</a></li>
<li><a class="reference internal" href="#controller">Controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#useful-topologies">Useful topologies</a><ul>
<li><a class="reference internal" href="#single-machine">Single machine</a></li>
<li><a class="reference internal" href="#virtual-machines">Virtual machines</a></li>
<li><a class="reference internal" href="#the-cloud">The Cloud</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=ca78e880"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>